!function(){class t{constructor(){this.timeout=30,this.isLoading=!1,this.isError=!1,this.actions={beforeLoad:[],afterLoad:[],onError:[],beforeRender:[],onRender:[]},this.addEventListener()}on(t,e){this.actions[t].push(e)}doAction(t){this.actions[t].forEach(t=>t())}addEventListener(){window.addEventListener("popstate",t=>this.renderFireContent(this.currentPath(),!1)),document.addEventListener("click",t=>{let e=t.target.closest("a[fire]");e&&e.hostname===window.location.hostname&&(t.preventDefault(),this.route(e.pathname+e.search+e.hash))}),document.addEventListener("submit",t=>{let e=t.target.closest("form[fire]");e&&e.action.startsWith(window.location.origin)&&(t.preventDefault(),this.submitFireForm(e))})}route(t){this.isLoading||this.renderFireContent(t)}reload(){this.isLoading||this.renderFireContent(this.currentPath())}submitFireForm(t){this.isLoading||this.request(t.getAttribute("action"),t.getAttribute("method"),new FormData(t)).then(e=>{if(e&&e.status&&"success"==e.status&&t.reset(),e&&e.redirect)window.location.href=e.redirect;else if(e&&e.push)this.renderFireContent(e.push);else if(e&&e.status&&e.message)for(let r of t.children)r.attributes.fire&&(r.attributes.fire.nodeValue==e.status?r.innerHTML=e.message:r.innerHTML="");else e&&e.content&&this.updateDocument(e)})}currentPath(){return window.location.pathname+window.location.search+window.location.hash}renderFireContent(t,e=!0){this.request(t).then(r=>{!this.isError&&r&&(r.content?(e&&this.updateRouteHistory(t),this.updateDocument(r)):r.push?this.route(r.push):r.redirect&&(window.location.href=r.redirect))})}updateRouteHistory(t){window.history.pushState({},"",t)}updateDocument(t){this.doAction("beforeRender"),this.setDocumentTitle(t.title),this.setFireContent(t.content),this.setFireBlocks(t.blocks),this.doAction("onRender")}setDocumentTitle(t){document.title=t}setFireContent(t){let e=document.getElementById("fireContent"),r=document.createElement("div");r.innerHTML=t,e.replaceChildren(...r.childNodes),r.querySelectorAll("script").forEach(t=>{let e=document.createElement("script");e.type=t.type||"text/javascript",t.src?e.src=t.src:e.textContent=t.textContent,document.head.appendChild(e),document.head.removeChild(e)})}setFireBlocks(t){Object.entries(t).forEach(([t,e])=>{let r=document.querySelector(`[fire="${t}"]`);r&&(r.innerHTML=e)})}async request(t,e="get",r=null){this.isLoading=!0,this.isError=!1,this.doAction("beforeLoad");try{let i=await fetch(t,{method:e,headers:{Accept:"application/json","Content-Agent":"fire-view"},redirect:"error",body:r,signal:AbortSignal.timeout(1e3*this.timeout)});return await i.json().catch(t=>this.fireError(t)).finally(()=>{this.isLoading=!1,this.doAction("afterLoad")})}catch(s){this.fireError(s)}}fireError(t){this.isError=!0,this.isLoading=!1,this.doAction("afterLoad"),this.doAction("onError"),console.error("Fire Error: "+t)}}document.addEventListener("DOMContentLoaded",()=>window.fireView=new t)}();